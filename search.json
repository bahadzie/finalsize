[{"path":"https://epiverse-trace.github.io/finalsize/CONTRIBUTING.html","id":null,"dir":"","previous_headings":"","what":"Contributing to finalsize","title":"Contributing to finalsize","text":"outlines propose change finalsize.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/CONTRIBUTING.html","id":"making-changes","dir":"","previous_headings":"","what":"Making changes","title":"Contributing to finalsize","text":"want make change, ’s good idea first file issue make sure someone team agrees ’s needed. ’ve found bug, please file issue illustrates bug minimal reprex (also help write unit test, needed). See bug report template. feature request see feature request.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/CONTRIBUTING.html","id":"pull-request-process","dir":"","previous_headings":"Making changes","what":"Pull request process","title":"Contributing to finalsize","text":"See pull request template Fork package clone onto computer. haven’t done , recommend using usethis::create_from_github(\"epiverse-trace/finalsize\", fork = TRUE). Install development dependencies devtools::install_dev_deps(), make sure package passes R CMD check running devtools::check(). R CMD check doesn’t pass cleanly, ’s good idea ask help continuing. Create Git branch pull request (PR). recommend using usethis::pr_init(\"brief-description--change\"). Make changes, commit git, create PR running usethis::pr_push(), following prompts browser. title PR briefly describe change. body PR contain Fixes #issue-number. user-facing changes, add bullet top NEWS.md (.e. just first header). Follow style described https://style.tidyverse.org/news.html.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/CONTRIBUTING.html","id":"code-style","dir":"","previous_headings":"Making changes","what":"Code style","title":"Contributing to finalsize","text":"New code follow tidyverse style guide. can use styler package apply styles, please don’t restyle code nothing PR. use roxygen2, Markdown syntax, documentation. use testthat unit tests. Contributions test cases included easier accept.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/CONTRIBUTING.html","id":"code-of-conduct","dir":"","previous_headings":"","what":"Code of Conduct","title":"Contributing to finalsize","text":"Please note finalsize project released Contributor Code Conduct. contributing project agree abide terms.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2022 finalsize authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"use-case","dir":"Articles","previous_headings":"","what":"Use case","title":"Calculating the final size of an epidemic","text":"epidemic underway. want know many individuals expect infected total given level transmission population susceptibility: cumulative sum infections, final size epidemic.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"what-we-have","dir":"Articles","previous_headings":"","what":"What we have","title":"Calculating the final size of an epidemic","text":"estimate infection’s basic reproduction number \\(R_0\\); estimate distribution population different demographic groups (typically age groups); estimate contacts individuals different demographic groups; estimate susceptibility demographic group infection.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"what-we-assume","dir":"Articles","previous_headings":"","what":"What we assume","title":"Calculating the final size of an epidemic","text":"infection dynamics can captured using Susceptible-Infectious-Recovered (SIR) Susceptible-Exposed-Infectious-Recovered (SEIR) model, individuals infected acquire immunity subsequent infection, least remaining duration epidemic.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"getting-finalsize","dir":"Articles","previous_headings":"","what":"Getting finalsize","title":"Calculating the final size of an epidemic","text":"finalsize package currently available Github, can installed using remotes devtools packages.","code":"# first install the remotes packages install.packages(\"remotes\")  # install finalsize using remotes remotes::install_github(\"epiverse-trace/finalsize\") library(finalsize)  # load necessary packages library(data.table) library(ggplot2)"},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"defining-a-value-for-r_0","dir":"Articles","previous_headings":"","what":"Defining a value for \\(R_0\\)","title":"Calculating the final size of an epidemic","text":"number statistical methods can used estimate \\(R_0\\) epidemic early stages available data. discussed , examples given episoap package. Instead, example considers infection \\(R_0\\) 2.0, similar potentially observed pandemic influenza.","code":"# define r0 as 2.0 r0 <- 2.0"},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"getting-and-preparing-contact-and-demography-data","dir":"Articles","previous_headings":"","what":"Getting and preparing contact and demography data","title":"Calculating the final size of an epidemic","text":"example uses social contact data POLYMOD project estimate final size epidemic U.K. data provided socialmixr package. contact data divided five age groups: 0 – 5, 5 – 18, 18 – 40, 40 – 65, 65 , specified using age.limits argument socialmixr::contact_matrix(). symmetric = TRUE argument socialmixr::contact_matrix() returns symmetric contact matrix, contacts reported group \\(\\{\\}\\) individuals group \\(\\{j\\}\\) reported group \\(\\{j\\}\\) group \\(\\{\\}\\). demographic data — number individuals age group — also available socialmixr::contact_matrix().","code":"# get UK polymod data polymod <- socialmixr::polymod contact_data <- socialmixr::contact_matrix(   polymod,   countries = \"United Kingdom\",   age.limits = c(0, 5, 18, 40, 65),   symmetric = TRUE )  # get the contact matrix and demography data contact_matrix <- t(contact_data$matrix) demography_vector <- contact_data$demography$population demography_data <- contact_data$demography  # scale the contact matrix so the largest eigenvalue is 1.0 # this is to ensure that the overall epidemic dynamics correctly reflect # the assumed value of R0 contact_matrix <- contact_matrix / max(eigen(contact_matrix)$values)  # divide each row of the contact matrix by the corresponding demography # this reflects the assumption that each individual in group {j} make contacts # at random with individuals in group {i} contact_matrix <- contact_matrix / demography_vector  n_demo_grps <- length(demography_vector)"},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"heterogeneous-social-mixing","dir":"Articles","previous_headings":"Getting and preparing contact and demography data","what":"Heterogeneous social mixing","title":"Calculating the final size of an epidemic","text":"social contact data used example illustrate important way populations may heterogeneous: various age groups can substantially different patterns social contacts, hence different probabilities acquiring transmitting infection epidemic. method implemented finalsize accounts heterogeneity. forms population heterogeneity covered “Heterogeneous susceptibility” vignette.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"population-susceptibility","dir":"Articles","previous_headings":"","what":"Population susceptibility","title":"Calculating the final size of an epidemic","text":"starting scenario, consider novel pathogen age groups similar, high susceptibility infection. means assumed individuals fall single category: fully susceptible. Full uniform susceptibility can modelled matrix values 1.0, many rows demographic groups. matrix single column, representing single susceptibility group individuals belong. Final size calculations also need know proportion demographic group \\(\\{\\}\\) falls susceptibility group \\(\\{j\\}\\). distribution age groups susceptibility groups can represented demography-susceptibility distribution matrix. Since individuals age group susceptibility, variation within age groups. Consequently, individuals age group assumed fully susceptible. can represented single-column matrix, many rows age groups, many columns susceptibility groups. example, matrix p_susc_uniform 5 rows, one age group, one column, single high susceptibility group holds individuals.","code":"# all individuals are equally and highly susceptible n_susc_groups <- 1L susc_guess <- 1.0 susc_uniform <- matrix(   data = susc_guess,   nrow = n_demo_grps,   ncol = n_susc_groups ) p_susc_uniform <- matrix(   data = 1.0,   nrow = n_demo_grps,   ncol = n_susc_groups )"},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"why-susceptibility-and-p_susceptibility-are-matrices","dir":"Articles","previous_headings":"Population susceptibility","what":"Why susceptibility and p_susceptibility are matrices","title":"Calculating the final size of an epidemic","text":"example models susceptibility (susc_uniform) demography--susceptibility (p_susc_uniform) matrices rather vectors. single susceptibility group special case general final size equation. finalsize supports multiple susceptibility groups (covered later), easily represented matrix, susceptibility matrix. element \\(\\{, j\\}\\) matrix represents susceptibility individuals demographic group \\(\\{\\}\\), susceptibility group \\(\\{j\\}\\). example, individuals equally susceptible infection, thus susceptibility matrix (susc_uniform) single column identical values. Consequently, demography-susceptibility distribution matrix (p_susc_uniform) dimensions, values 1.0. See “Heterogeneous susceptibility” example cases susceptibility varies within age groups.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"running-final_size","dir":"Articles","previous_headings":"","what":"Running final_size","title":"Calculating the final size of an epidemic","text":"final size epidemic population can calculated using function package, final_size(). example allows function fall back default options arguments solver (\"iterative\") control (empty list).","code":"# calculate final size final_size_data <- final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susc_uniform,   p_susceptibility = p_susc_uniform )  # order demographic groups final_size_data$demo_grp <- factor(   final_size_data$demo_grp,   levels = demography_data$age.group )"},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"visualise-final-sizes","dir":"Articles","previous_headings":"Running final_size","what":"Visualise final sizes","title":"Calculating the final size of an epidemic","text":"Figure 1: Final size SIR epidemic age group. final size cumulative number infections age group course epidemic, expressed proportion respective age group.","code":"# plot data ggplot(final_size_data) +   geom_col(     aes(       demo_grp, p_infected     ),     fill = \"lightgrey\",     col = \"black\"   ) +   scale_y_continuous(     labels = scales::percent,     limits = c(0, 1)   ) +   theme_classic() +   coord_cartesian(     expand = FALSE   ) +   labs(     x = \"Age group\",     y = \"% Infected\"   )"},{"path":"https://epiverse-trace.github.io/finalsize/articles/finalsize.html","id":"final-size-proportions-to-counts","dir":"Articles","previous_headings":"Running final_size","what":"Final size proportions to counts","title":"Calculating the final size of an epidemic","text":"finalsize returns proportion age (susceptibility) group infected epidemic outbreak. final counts individuals infected can visualised well, multiplying final proportion age group infected total number individuals group. example show can done. Figure 2: Final size epidemic outbreak population, different values infection \\(R_0\\). Converting final size proportions age group counts shows individuals aged 18 – 65 make bulk cases scenario. may attributed largest age range analysis (years range ), people fall wide range others. Contrast figure one , similar proportions age group infected.","code":"# prepare demography data demography_data <- contact_data$demography  # merge final size counts with demography vector final_size_data <- merge.data.table(   final_size_data,   demography_data,   by.x = \"demo_grp\",   by.y = \"age.group\" )  # reset age group order final_size_data$demo_grp <- factor(   final_size_data$demo_grp,   levels = contact_data$demography$age.group )  # multiply counts with proportion infected final_size_data$n_infected <- final_size_data$p_infected *   final_size_data$population ggplot(final_size_data) +   geom_col(     aes(       x = demo_grp, y = n_infected     ),     fill = \"lightgrey\",     col = \"black\"   ) +   scale_y_continuous(     labels = scales::comma_format(       scale = 1e-6, suffix = \"M\"     ),     limits = c(0, 15e6)   ) +   theme_classic() +   coord_cartesian(     expand = FALSE   ) +   labs(     x = \"Age group\",     y = \"Number infected (millions)\"   )"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/articles/uncertainty_params.html","id":"use-case","dir":"Articles","previous_headings":"","what":"Use case","title":"Modelling uncertainty in R₀","text":"infection parameter (\\(R_0\\)) uncertain. want know much variation cause estimated final size epidemic.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/uncertainty_params.html","id":"what-we-have","dir":"Articles","previous_headings":"","what":"What we have","title":"Modelling uncertainty in R₀","text":"addition \\(R_0\\), demography data, social contact data, data distribution susceptibility among age groups; measure error estimated \\(R_0\\) infection.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/uncertainty_params.html","id":"what-we-assume","dir":"Articles","previous_headings":"","what":"What we assume","title":"Modelling uncertainty in R₀","text":"SIR epidemic, complete partitioning individuals different demographic infection risk groups.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/uncertainty_params.html","id":"getting-r_0-contact-and-demography-data-and-susceptibility","dir":"Articles","previous_headings":"","what":"Getting \\(R_0\\), contact and demography data, and susceptibility","title":"Modelling uncertainty in R₀","text":"example uses social contact data POLYMOD project estimate final size epidemic U.K. data provided socialmixr package. data handled just Basic usage vignette. example also considers infection \\(R_0\\) 2.0. simplicity, example considers scenario susceptibility infection vary.","code":"# get UK polymod data polymod <- socialmixr::polymod contact_data <- socialmixr::contact_matrix(   polymod,   countries = \"United Kingdom\",   age.limits = c(0, 5, 18, 40, 65),   symmetric = TRUE )  # get the contact matrix and demography data contact_matrix <- t(contact_data$matrix) demography_vector <- contact_data$demography$population  # scale the contact matrix so the largest eigenvalue is 1.0 contact_matrix <- contact_matrix / max(eigen(contact_matrix)$values)  # divide each row of the contact matrix by the corresponding demography contact_matrix <- contact_matrix / demography_vector  n_demo_grps <- length(demography_vector) # mean R0 is 2.0 r0_mean <- 2.0 # susceptibility is uniform susc_uniform <- matrix(   data = 1,   nrow = n_demo_grps,   ncol = 1L )  # p_susceptibility is uniform p_susc_uniform <- susc_uniform"},{"path":"https://epiverse-trace.github.io/finalsize/articles/uncertainty_params.html","id":"running-final_size-over-r_0-samples","dir":"Articles","previous_headings":"","what":"Running final_size over \\(R_0\\) samples","title":"Modelling uncertainty in R₀","text":"basic reproduction number \\(R_0\\) infection might uncertain early stages epidemic. uncertainty can modelled running final_size() multiple times contact, demography, susceptibility data, sampling \\(R_0\\) values distribution. example assumes \\(R_0\\) estimate, uncertainty around estimate, provided mean standard deviation normal distribution. example considers normal distribution \\(N(\\mu = 2.0, \\sigma = 0.1)\\), \\(R_0\\) 2.0. can draw 1,000 \\(R_0\\) samples distribution run final_size() contact data demography data sample. quick, finalsize Rcpp package C++ backend.","code":"# create an R0 samples vector r0_samples <- rnorm(n = 1000, mean = r0_mean, sd = 0.1) # run final size on each sample with the same data final_size_data <- Map(   r0_samples, seq_along(r0_samples),   f = function(r0, i) {     # the i-th final size estimate     fs <- final_size(       r0 = r0,       contact_matrix = contact_matrix,       demography_vector = demography_vector,       susceptibility = susc_uniform,       p_susceptibility = p_susc_uniform     )      fs$replicate <- i     fs$r0_estimate <- r0     fs   } )  # combine data final_size_data <- rbindlist(final_size_data)  # order age groups final_size_data$demo_grp <- factor(   final_size_data$demo_grp,   levels = contact_data$demography$age.group )"},{"path":"https://epiverse-trace.github.io/finalsize/articles/uncertainty_params.html","id":"visualise-uncertainty-in-final-size","dir":"Articles","previous_headings":"Running final_size over \\(R_0\\) samples","what":"Visualise uncertainty in final size","title":"Modelling uncertainty in R₀","text":"Figure 1: Estimated ranges final size hypothetical SIR epidemic age groups U.K. population, \\(R_0\\) estimated 2.0, standard deviation around estimate 0.1. example, relatively low uncertainty \\(R_0\\) estimates can also lead uncertainty estimated final size epidemic. Points represent means, ranges extend 5th 95th percentiles.","code":"ggplot(final_size_data) +   stat_summary(     aes(       demo_grp, p_infected     ),     fun = mean,     fun.min = function(x) {       quantile(x, 0.05)     },     fun.max = function(x) {       quantile(x, 0.95)     }   ) +   scale_y_continuous(     labels = scales::percent,     limits = c(0.25, 1)   ) +   theme_classic() +   theme(     legend.position = \"top\",     legend.key.height = unit(2, \"mm\"),     legend.title = ggtext::element_markdown(       vjust = 1     )   ) +   coord_cartesian(     expand = TRUE   ) +   labs(     x = \"Age group\",     y = \"% Infected\"   )"},{"path":"https://epiverse-trace.github.io/finalsize/articles/varying_susceptibility.html","id":"use-case","dir":"Articles","previous_headings":"","what":"Use case","title":"Modelling heterogeneous susceptibility","text":"substantial heterogeneity susceptibility infection population. want know heterogeneity affect final size epidemic.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/varying_susceptibility.html","id":"what-we-have","dir":"Articles","previous_headings":"","what":"What we have","title":"Modelling heterogeneous susceptibility","text":"addition infection \\(R_0\\), demography data, social contact data; Data within- -group variation susceptibility infection; Data proportion (probability) individuals demographic group specific susceptibility (risk) group.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/varying_susceptibility.html","id":"what-we-assume","dir":"Articles","previous_headings":"","what":"What we assume","title":"Modelling heterogeneous susceptibility","text":"addition SIR epidemic; partitioning individuals demographic risk groups complete, .e., individuals remain unaccounted .","code":""},{"path":"https://epiverse-trace.github.io/finalsize/articles/varying_susceptibility.html","id":"getting-r_0-and-contact-and-demography-data","dir":"Articles","previous_headings":"","what":"Getting \\(R_0\\) and contact and demography data","title":"Modelling heterogeneous susceptibility","text":"example uses social contact data POLYMOD project estimate final size epidemic U.K. data provided socialmixr package. data handled just “Basic usage” vignette, code displayed . example also considers disease \\(R_0\\) 2.0.","code":"# get UK polymod data polymod <- socialmixr::polymod contact_data <- socialmixr::contact_matrix(   polymod,   countries = \"United Kingdom\",   age.limits = c(0, 5, 18, 40, 65),   symmetric = TRUE )  # get the contact matrix and demography data contact_matrix <- t(contact_data$matrix) demography_vector <- contact_data$demography$population  # scale the contact matrix so the largest eigenvalue is 1.0 contact_matrix <- contact_matrix / max(eigen(contact_matrix)$values)  # divide each row of the contact matrix by the corresponding demography contact_matrix <- contact_matrix / demography_vector  n_demo_grps <- length(demography_vector) r0 <- 2.0"},{"path":"https://epiverse-trace.github.io/finalsize/articles/varying_susceptibility.html","id":"susceptibility-variation-between-age-groups","dir":"Articles","previous_headings":"","what":"Susceptibility variation between age groups","title":"Modelling heterogeneous susceptibility","text":"example considers scenario susceptibility infection varies age groups, within groups. example, susceptibility infection increases age. can modelled susceptibility matrix higher values 40 – 60 65+ age groups, relatively lower values groups. Note susceptibility matrix (susc_variable) still one column. next example show modelled matrix. corresponding demography-susceptibility group distribution matrix one-column matrix 1.0s: variation susceptibility within groups. can compare final size population heterogeneous susceptibility population uniform, high susceptibility. Visualise effect modelling age-dependent susceptibility uniform susceptibility age groups. Figure 1: Final sizes epidemics populations wherein susceptibility infection either uniform (green), heterogeneous (purple), older individuals susceptible infection. Note , shown example, population heterogeneous susceptibility always expected lower final epidemic size overall otherwise identical population fully susceptible. illustrates broader point infections one age group independent infections age groups. due direct indirect social contacts age groups. Reducing susceptibility (thus infections) one age group can indirectly help reduce infections age groups well, overall level epidemic transmission reduced.","code":"# susceptibility is higher for the old susc_variable <- matrix(   data = c(0.2, 0.5, 0.6, 0.9, 1.0) ) n_susc_groups <- 1L p_susc_uniform <- matrix(   data = 1.0,   nrow = n_demo_grps,   ncol = n_susc_groups ) # run final_size with default solvers and control options # final size with heterogeneous susceptibility final_size_heterog <- final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susc_variable,   p_susceptibility = p_susc_uniform ) # prepare uniform susceptibility matrix susc_uniform <- matrix(1.0, nrow = n_demo_grps, ncol = n_susc_groups)  # run final size with uniform susceptibility final_size_uniform <- final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susc_uniform,   p_susceptibility = p_susc_uniform ) # assign scenario name and join data final_size_heterog$scenario <- \"heterogeneous\" final_size_uniform$scenario <- \"uniform\"  # join dataframes final_size_data <- rbind(   final_size_heterog,   final_size_uniform )  # prepare age group order final_size_data$demo_grp <- factor(   final_size_data$demo_grp,   levels = contact_data$demography$age.group ) ggplot(final_size_data) +   geom_col(     aes(       x = demo_grp, y = p_infected,       fill = scenario     ),     col = \"black\",     position = position_dodge(       width = 0.75     )   ) +   scale_fill_discrete_qualitative(     palette = \"Cold\",     name = \"Population susceptibility\",     labels = c(\"Heterogeneous\", \"Uniform\")   ) +   scale_y_continuous(     labels = scales::percent,     limits = c(0, 1)   ) +   theme_classic() +   theme(     legend.position = \"top\",     legend.key.height = unit(2, \"mm\"),     legend.title = ggtext::element_markdown(       vjust = 1     )   ) +   coord_cartesian(     expand = FALSE   ) +   labs(     x = \"Age group\",     y = \"% Infected\"   )"},{"path":"https://epiverse-trace.github.io/finalsize/articles/varying_susceptibility.html","id":"susceptibility-variation-within-and-between-age-groups","dir":"Articles","previous_headings":"","what":"Susceptibility variation within and between age groups","title":"Modelling heterogeneous susceptibility","text":"example considers scenario susceptibility infection varies within age groups. Immunisation infection intervention campaign common cause within-age group variation susceptibility, example can thought examining effect vaccination. effect immunisation susceptibility can modelled reduction initial susceptibility age group. done adding column susceptibility matrix, lower values first column. example considers modest 25% reduction susceptibility due vaccination. Note two susceptibility groups, susceptibility matrix two columns. corresponding demography-susceptibility distribution matrix must also two columns! also need model proportion age group immunised, therefore lower susceptibility infection. , can modify demography-susceptibility distribution matrix. example model considers half age group immunised non-immunised groups. general terms, interpreted rate vaccine uptake, effect existing immunity previous infection similar pathogen. Recall row demography-susceptibility distribution matrix must always sum 1.0! effect immunisation (reduction susceptibility) can visualised comparing proportion immunised un-immunised groups infected. Figure 2: Final size SIR epidemic \\(R_0\\) = 2.0, population wherein 50% age group immunised infection. immunisation assumed reduce initial susceptibility age group 25%. leads within- -group heterogeneity susceptibility. Vaccinating even 50% age group can substantially reduce epidemic final size comparison scenario immunisation (grey). Note final sizes figure 50%.","code":"# immunisation effect immunisation_effect <- 0.25 # model an immunised group with a 25% lower susceptibility susc_immunised <- cbind(   susc_variable,   susc_variable * (1 - immunisation_effect) )  # assign names to groups colnames(susc_immunised) <- c(\"Un-immunised\", \"Immunised\") n_risk_groups <- ncol(susc_immunised) # immunisation increases with age between 20% (infants) and 90% (65+) immunisation_rate <- rep(0.5, n_demo_grps)  # add a second column to p_susceptibility p_susc_immunised <- cbind(   susceptible = p_susc_uniform - immunisation_rate,   immunised = immunisation_rate ) # we run final size over all r0 values final_size_immunised <- final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susc_immunised,   p_susceptibility = p_susc_immunised )  # add scenario identifier final_size_immunised$scenario <- \"immunisation\"  # prepare age group order final_size_heterog$demo_grp <- factor(   final_size_heterog$demo_grp,   levels = contact_data$demography$age.group )  final_size_immunised$demo_grp <- factor(   final_size_immunised$demo_grp,   levels = contact_data$demography$age.group ) ggplot(final_size_immunised) +   geom_col(     data = final_size_heterog,     aes(       x = demo_grp, y = p_infected,       fill = \"baseline\",       colour = \"baseline\"     ),     width = 0.75,     show.legend = TRUE   ) +   geom_col(     aes(       x = demo_grp, y = p_infected,       fill = susc_grp     ),     col = \"black\",     position = position_dodge()   ) +   scale_fill_discrete_qualitative(     palette = \"Dynamic\",     rev = TRUE,     limits = c(\"Immunised\", \"Un-immunised\"),     name = \"Immunisation scenario\",     na.value = \"lightgrey\"   ) +   scale_colour_manual(     values = \"black\",     name = NULL,     labels = \"Susceptibility heterogeneous\\nbetween groups,\\nno immunisation\"   ) +   scale_y_continuous(     labels = scales::percent,     limits = c(0, 0.5)   ) +   theme_classic() +   theme(     legend.position = \"top\",     legend.key.height = unit(2, \"mm\"),     legend.title = ggtext::element_markdown(       vjust = 1     )   ) +   guides(     colour = guide_legend(       override.aes = list(fill = \"lightgrey\")     ),     fill = guide_legend(       nrow = 2,       title.position = \"top\"     )   ) +   coord_cartesian(     expand = FALSE   ) +   labs(     x = \"Age group\",     y = \"% Infected\",     fill = \"Immunisation\\nscenario\"   )"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Pratik Gupte. Author, maintainer, copyright holder. Edwin Van Leeuwen. Author, copyright holder. Adam Kucharski. Author, copyright holder. Hugo Gruson. Contributor. Thibaut Jombart. Contributor.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Gupte P, Van Leeuwen E, Kucharski (2022). finalsize: Calculate Final Size Epidemic. https://epiverse-trace.github.io/finalsize/, https://github.com/epiverse-trace/finalsize.","code":"@Manual{,   title = {finalsize: Calculate the Final Size of an Epidemic},   author = {Pratik Gupte and Edwin {Van Leeuwen} and Adam Kucharski},   year = {2022},   note = {https://epiverse-trace.github.io/finalsize/, https://github.com/epiverse-trace/finalsize}, }"},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"finalsize-calculate-the-final-size-of-an-epidemic-","dir":"","previous_headings":"","what":"Calculate the Final Size of an Epidemic","title":"Calculate the Final Size of an Epidemic","text":"finalsize provides calculations final size epidemic population demographic variation contact patterns, variation within age groups susceptibility disease. finalsize implements methods outlined Andreasen (2011), Miller (2012), Kucharski et al. (2014), Bidari et al. (2016). finalsize can help provide rough estimates effectiveness pharmaceutical interventions form immunisation programmes, effect naturally acquired immunity previous infection (see vignette). finalsize relies Eigen via RcppEigen fast matrix algebra, developed Centre Mathematical Modelling Infectious Diseases London School Hygiene Tropical Medicine part Epiverse Initiative.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Calculate the Final Size of an Epidemic","text":"package can installed using current development version finalsize can installed Github using remotes package.","code":"install.packages(\"finalsize\") # install.packages(\"devtools\") devtools::install_github(\"epiverse-trace/finalsize\")"},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"quick-start","dir":"","previous_headings":"","what":"Quick start","title":"Calculate the Final Size of an Epidemic","text":"finalsize provides single function final_size(), calculate final size epidemic. , example using social contact data socialmixr package investigates final size epidemic disease R0 1.5, given three age groups interest — 0-19, 20-39 40+. -20 age group assumed fully susceptible disease, whereas individuals aged 20 half susceptible 20.","code":"# load finalsize library(finalsize)  # Load example POLYMOD data included with the package data(polymod_uk)  # Define contact matrix (entry {ij} is contacts in group i reported by group j) contact_matrix <- polymod_uk$contact_matrix  # Define population in each age group demography_vector <- polymod_uk$demography_vector  # Define susceptibility of each group susceptibility <- matrix(   data = c(1.0, 0.5, 0.5),   nrow = length(demography_vector),   ncol = 1 )  # Assume uniform susceptibility within age groups p_susceptibility <- matrix(   data = 1.0,   nrow = length(demography_vector),   ncol = 1 )  # R0 of the disease r0 <- 1.5 # assumed for pandemic influenza  # Calculate the proportion of individuals infected final_size(   r0,   contact_matrix,   demography_vector,   p_susceptibility,   susceptibility ) #>   demo_grp   susc_grp susceptibility p_infected #> 1   [0,20) susc_grp_1            1.0 0.32849966 #> 2  [20,40) susc_grp_1            0.5 0.10532481 #> 3      40+ susc_grp_1            0.5 0.06995193"},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"package-vignettes","dir":"","previous_headings":"","what":"Package vignettes","title":"Calculate the Final Size of an Epidemic","text":"details use finalsize can found online documentation package vignettes, “Articles”.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"help","dir":"","previous_headings":"","what":"Help","title":"Calculate the Final Size of an Epidemic","text":"report bug please open issue.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"contribute","dir":"","previous_headings":"","what":"Contribute","title":"Calculate the Final Size of an Epidemic","text":"Contributions finalsize welcomed. Please follow package contributing guide.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"code-of-conduct","dir":"","previous_headings":"","what":"Code of conduct","title":"Calculate the Final Size of an Epidemic","text":"Please note finalsize project released Contributor Code Conduct. contributing project, agree abide terms.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"citing-this-package","dir":"","previous_headings":"","what":"Citing this package","title":"Calculate the Final Size of an Epidemic","text":"","code":"citation(\"finalsize\") #>  #> To cite package 'finalsize' in publications use: #>  #>   Gupte P, Van Leeuwen E, Kucharski A (2022). _finalsize: Calculate the #>   Final Size of an Epidemic_. #>   https://epiverse-trace.github.io/finalsize/, #>   https://github.com/epiverse-trace/finalsize. #>  #> A BibTeX entry for LaTeX users is #>  #>   @Manual{, #>     title = {finalsize: Calculate the Final Size of an Epidemic}, #>     author = {Pratik Gupte and Edwin {Van Leeuwen} and Adam Kucharski}, #>     year = {2022}, #>     note = {https://epiverse-trace.github.io/finalsize/, #> https://github.com/epiverse-trace/finalsize}, #>   }"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_iterative.html","id":null,"dir":"Reference","previous_headings":"","what":"Iterative solver for final size. — .solve_iterative","title":"Iterative solver for final size. — .solve_iterative","text":"Iterative solver final size.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_iterative.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Iterative solver for final size. — .solve_iterative","text":"","code":".solve_iterative(   contact_matrix,   demography_vector,   susceptibility,   iterations = 10000L,   tolerance = 1e-06,   step_rate = 1.9,   adapt_step = TRUE )"},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_iterative.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Iterative solver for final size. — .solve_iterative","text":"contact_matrix Social contact matrix. Entry \\(mm_{ij}\\) gives average number contacts group \\(\\) reported participants group \\(j\\). demography_vector Demography vector. Entry \\(pp_{}\\) gives proportion total population group \\(\\) (model normalise needed). susceptibility matrix giving susceptibility individuals demographic group \\(\\) risk group \\(j\\). iterations Number solver iterations. Defaults 10,000. tolerance Solver error tolerance. Solving final size ends error drops tolerance. Defaults set 1e-6. Larger tolerance values likely lead inaccurate final size estimates. step_rate solver step rate. Defaults 1.9 value found work well. adapt_step Boolean, whether solver step rate changed based solver error. Defaults TRUE.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_iterative.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Iterative solver for final size. — .solve_iterative","text":"vector final sizes, size (N demography groups * N risk groups).","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_newton.html","id":null,"dir":"Reference","previous_headings":"","what":"Newton solver for final size. — .solve_newton","title":"Newton solver for final size. — .solve_newton","text":"Newton solver final size.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_newton.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Newton solver for final size. — .solve_newton","text":"","code":".solve_newton(   contact_matrix,   demography_vector,   susceptibility,   iterations = 10000L,   tolerance = 1e-06 )"},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_newton.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Newton solver for final size. — .solve_newton","text":"contact_matrix Social contact matrix. Entry \\(mm_{ij}\\) gives average number contacts group \\(\\) reported participants group \\(j\\). demography_vector Demography vector. Entry \\(pp_{}\\) gives proportion total population group \\(\\) (model normalise needed). susceptibility matrix giving susceptibility individuals demographic group \\(\\) risk group \\(j\\). iterations Number solver iterations. Defaults 10,000. tolerance Solver error tolerance. Solving final size ends error drops tolerance. Defaults set 1e-6. Larger tolerance values likely lead inaccurate final size estimates.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_newton.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Newton solver for final size. — .solve_newton","text":"two dimensional array final sizes per age-risk group.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":null,"dir":"Reference","previous_headings":"","what":"Final size of an epidemic — final_size","title":"Final size of an epidemic — final_size","text":"final_size calculates final size epidemic outbreak population heterogeneous mixing, heterogeneous susceptibility infection conferred immunisation programme.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Final size of an epidemic — final_size","text":"","code":"final_size(   r0,   contact_matrix,   demography_vector,   p_susceptibility,   susceptibility,   solver = c(\"iterative\", \"newton\"),   control = list() )"},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Final size of an epidemic — final_size","text":"r0 basic reproductive number \\(R_0\\) disease. contact_matrix Social contact matrix. Entry \\(m_{ij}\\) gives average number contacts group \\(\\) reported participants group \\(j\\) demography_vector Demography vector. Entry \\(v_{}\\) gives proportion total population group \\(\\) (model normalise needed). p_susceptibility matrix giving probability individual demography group \\(\\) risk (susceptibility) group \\(j\\). row represents overall distribution individuals demographic group \\(\\) across risk groups, row must sum 1.0. susceptibility matrix giving susceptibility individuals demographic group \\(\\) risk group \\(j\\). solver solver use. Options \"iterative\" (default) \"newton\", iterative solver, Newton solver, respectively. Special conditions apply using Newton solver, see control argument. control list named solver options, see Solver options.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Final size of an epidemic — final_size","text":"data.frame proportion infected individuals, within demography group susceptibility group combination. demography groups susceptibility groups named, names added relevant columns. groups named, synthetic names added (e.g. demo_grp_1, susc_grp_1).","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"solver-options","dir":"Reference","previous_headings":"","what":"Solver options","title":"Final size of an epidemic — final_size","text":"control argument accepts list solver options, iterative solver taking two extra arguments Newton solver. optional argument, default options used within solver functions argument missing. Arguments provided override solver defaults.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"common-options","dir":"Reference","previous_headings":"","what":"Common options","title":"Final size of an epidemic — final_size","text":"iterations: number iterations solve final size, unless error solver tolerance. Default = 10000. tolerance: solver tolerance; solving final size ends error drops tolerance. Defaults set 1e-6. Larger tolerance values likely lead inaccurate final size estimates.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"iterative-solver-options","dir":"Reference","previous_headings":"","what":"Iterative solver options","title":"Final size of an epidemic — final_size","text":"step_rate: solver step rate. Defaults 1.9 value found work well. adapt_step: Boolean, whether solver step rate changed based solver error. Defaults TRUE.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Final size of an epidemic — final_size","text":"","code":"# load example POLYMOD data included in the package data(polymod_uk) r0 <- 2.0 contact_matrix <- polymod_uk$contact_matrix demography_vector <- polymod_uk$demography_vector  # define the number of age and susceptibility groups n_demo_grps <- length(demography_vector) n_risk_grps <- 3  # prepare p_susceptibility and susceptibility psusc <- matrix(   data = 1, nrow = n_demo_grps, ncol = n_risk_grps ) psusc <- psusc / rowSums(psusc) # In this example, all risk groups from all age groups are fully # susceptible susc <- matrix(   data = 1, nrow = n_demo_grps, ncol = n_risk_grps )  # using default arguments for `solver` and `control` final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   p_susceptibility = psusc,   susceptibility = susc ) #>   demo_grp   susc_grp susceptibility p_infected #> 1   [0,20) susc_grp_1              1  0.8532885 #> 2  [20,40) susc_grp_1              1  0.7974557 #> 3      40+ susc_grp_1              1  0.6880834 #> 4   [0,20) susc_grp_2              1  0.8532885 #> 5  [20,40) susc_grp_2              1  0.7974557 #> 6      40+ susc_grp_2              1  0.6880834 #> 7   [0,20) susc_grp_3              1  0.8532885 #> 8  [20,40) susc_grp_3              1  0.7974557 #> 9      40+ susc_grp_3              1  0.6880834  # using manually specified solver settings for the iterative solver control <- list(   iterations = 100,   tolerance = 1e-3,   step_rate = 1.9,   adapt_step = TRUE )  final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   p_susceptibility = psusc,   susceptibility = susc,   solver = \"iterative\",   control = control ) #>   demo_grp   susc_grp susceptibility p_infected #> 1   [0,20) susc_grp_1              1  0.8532715 #> 2  [20,40) susc_grp_1              1  0.7974597 #> 3      40+ susc_grp_1              1  0.6880988 #> 4   [0,20) susc_grp_2              1  0.8532715 #> 5  [20,40) susc_grp_2              1  0.7974597 #> 6      40+ susc_grp_2              1  0.6880988 #> 7   [0,20) susc_grp_3              1  0.8532715 #> 8  [20,40) susc_grp_3              1  0.7974597 #> 9      40+ susc_grp_3              1  0.6880988  # manual settings for the newton solver control <- list(   iterations = 100,   tolerance = 1e-3 )  final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   p_susceptibility = psusc,   susceptibility = susc,   solver = \"newton\",   control = control ) #>   demo_grp   susc_grp susceptibility p_infected #> 1   [0,20) susc_grp_1              1  0.9999876 #> 2  [20,40) susc_grp_1              1  0.9999873 #> 3      40+ susc_grp_1              1  0.9999867 #> 4   [0,20) susc_grp_2              1  0.9999876 #> 5  [20,40) susc_grp_2              1  0.9999873 #> 6      40+ susc_grp_2              1  0.9999867 #> 7   [0,20) susc_grp_3              1  0.9999876 #> 8  [20,40) susc_grp_3              1  0.9999873 #> 9      40+ susc_grp_3              1  0.9999867"},{"path":"https://epiverse-trace.github.io/finalsize/reference/polymod_uk.html","id":null,"dir":"Reference","previous_headings":"","what":"Example POLYMOD social contact data for the U.K. — polymod_uk","title":"Example POLYMOD social contact data for the U.K. — polymod_uk","text":"example social contact demography data use finalsize, accessed POLYMOD social contacts dataset using socialmixr package. Data United Kingdom, age limits set 0, 20, 40 years, symmetric = TRUE. Code get data given data-raw/polymod_uk.R.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/polymod_uk.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Example POLYMOD social contact data for the U.K. — polymod_uk","text":"","code":"polymod_uk"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/reference/polymod_uk.html","id":"polymod-uk","dir":"Reference","previous_headings":"","what":"polymod_uk","title":"Example POLYMOD social contact data for the U.K. — polymod_uk","text":"list two named elements: contact_matrix contact matrix mean contacts age groups. matrix scaled largest real eigenvalue,  row scaled corresponding element demography_vector. demography_vector vector number individuals three age groups: 0 -- 20, 20 -- 40, 40+.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/polymod_uk.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Example POLYMOD social contact data for the U.K. — polymod_uk","text":"doi:10.1371/journal.pmed.0050074 ; obtained using socialmixr::polymod. See methods data-raw/polymod_uk.R.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/news/index.html","id":"finalsize-0109000","dir":"Changelog","previous_headings":"","what":"finalsize 0.1.0.9000","title":"finalsize 0.1.0.9000","text":"Added NEWS.md file track changes package.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/news/index.html","id":"finalsize-01","dir":"Changelog","previous_headings":"","what":"finalsize 0.1","title":"finalsize 0.1","text":"Initial release finalsize, R package calculate final size epidemic population demographic variation social contacts susceptibility infection. release includes: 1. choice equation solver functions. 2. 100% code coverage, 3. basic usage vignette, two advanced vignettes, 4. Example data POLYMOD dataset obtained using socialmixr R package, 5. Workflows render vignettes README website.","code":""}]
