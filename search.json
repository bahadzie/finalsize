[{"path":"https://epiverse-trace.github.io/finalsize/CONTRIBUTING.html","id":null,"dir":"","previous_headings":"","what":"Contributing to finalsize","title":"Contributing to finalsize","text":"outlines propose change finalsize.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/CONTRIBUTING.html","id":"making-changes","dir":"","previous_headings":"","what":"Making changes","title":"Contributing to finalsize","text":"want make change, ’s good idea first file issue make sure someone team agrees ’s needed. ’ve found bug, please file issue illustrates bug minimal reprex (also help write unit test, needed). See bug report template. feature request see feature request.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/CONTRIBUTING.html","id":"pull-request-process","dir":"","previous_headings":"Making changes","what":"Pull request process","title":"Contributing to finalsize","text":"See pull request template Fork package clone onto computer. haven’t done , recommend using usethis::create_from_github(\"epiverse-trace/finalsize\", fork = TRUE). Install development dependencies devtools::install_dev_deps(), make sure package passes R CMD check running devtools::check(). R CMD check doesn’t pass cleanly, ’s good idea ask help continuing. Create Git branch pull request (PR). recommend using usethis::pr_init(\"brief-description--change\"). Make changes, commit git, create PR running usethis::pr_push(), following prompts browser. title PR briefly describe change. body PR contain Fixes #issue-number. user-facing changes, add bullet top NEWS.md (.e. just first header). Follow style described https://style.tidyverse.org/news.html.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/CONTRIBUTING.html","id":"code-style","dir":"","previous_headings":"Making changes","what":"Code style","title":"Contributing to finalsize","text":"New code follow tidyverse style guide. can use styler package apply styles, please don’t restyle code nothing PR. use roxygen2, Markdown syntax, documentation. use testthat unit tests. Contributions test cases included easier accept.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/CONTRIBUTING.html","id":"code-of-conduct","dir":"","previous_headings":"","what":"Code of Conduct","title":"Contributing to finalsize","text":"Please note finalsize project released Contributor Code Conduct. contributing project agree abide terms.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2022 finalsize authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Adam Kucharski. Author, maintainer. Pratik Gupte. Author. Hugo Gruson. Contributor. Thibaut Jombart. Contributor.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Kucharski , Gupte P (2022). finalsize: Calculates Final Size SIR Epidemic Heterogenous Population. R package version 0.1.","code":"@Manual{,   title = {finalsize: Calculates Final Size for SIR Epidemic in Heterogenous Population},   author = {Adam Kucharski and Pratik Gupte},   year = {2022},   note = {R package version 0.1}, }"},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"calculate-the-final-size-of-an-epidemic-","dir":"","previous_headings":"","what":"Calculates Final Size for SIR Epidemic in Heterogenous Population","title":"Calculates Final Size for SIR Epidemic in Heterogenous Population","text":"finalsize provides quick back---envelope calculations final size epidemic outbreak population demographic variation contact patterns, variation within age groups susceptibility disease. finalsize can help provide rough estimates effectiveness pharmaceutical interventions form immunisation programmes, effect naturally acquired immunity previous infection (see vignette). finalsize relies Eigen via RcppEigen fast matrix algebra, developed Centre Mathematical Modelling Infectious Diseases London School Hygiene Tropical Medicine part Epiverse Initiative.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Calculates Final Size for SIR Epidemic in Heterogenous Population","text":"can install development version finalsize GitHub :","code":"# install.packages(\"devtools\") devtools::install_github(\"epiverse-trace/finalsize\")"},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"quick-start","dir":"","previous_headings":"","what":"Quick start","title":"Calculates Final Size for SIR Epidemic in Heterogenous Population","text":"finalsize provides single function final_size(), calculate final size epidemic. , example using social contact data socialmixr package investigates final size epidemic disease R0 2.0, given three age groups interest — 0-19, 20-39 40+. -20 age group assumed fully susceptible disease, whereas individuals aged 20 half susceptible.","code":"# Load socialmixr package # install.packages(\"socialmixr\") library(socialmixr) #>  #> Attaching package: 'socialmixr' #> The following object is masked from 'package:utils': #>  #>     cite  # load finalsize library(finalsize)  # Load data from POLYMOD data(polymod) contact_data <- contact_matrix(   polymod,   countries = \"United Kingdom\",   age.limits = c(0, 20, 40),   symmetric = TRUE ) #> Using POLYMOD social contact data. To cite this in a publication, use the 'cite' function #> Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option  # Define contact matrix (entry {ij} is contacts in group i reported by group j) contact_matrix <- t(contact_data$matrix)  # Define population in each age group demography_vector <- contact_data$demography$population  # Scale the contact matrix to ensure its largest eigenvalue is 1.0 contact_matrix <- contact_matrix / max(eigen(contact_matrix)$values)  # Divide the contact matrix by the demography # Each i-th row divided by the corresponding i-th element of demography contact_matrix <- contact_matrix / demography_vector  # Define susceptibility of each group susceptibility <- matrix(   data = c(1.0, 0.5, 0.5),   nrow = length(demography_vector),   ncol = 1 )  # Assume uniform susceptibility within age groups p_susceptibility <- matrix(   data = 1.0,   nrow = length(demography_vector),   ncol = 1 )  # R0 of the disease r0 <- 1.3 # seasonal influenza  # Calculate the proportion of individuals infected finalsize::final_size(   r0,   contact_matrix,   demography_vector,   p_susceptibility,   susceptibility ) #>   demo_grp   susc_grp susceptibility  p_infected #> 1   [0,20) susc_grp_1            1.0 0.036325712 #> 2  [20,40) susc_grp_1            0.5 0.009726187 #> 3      40+ susc_grp_1            0.5 0.006240606"},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"help","dir":"","previous_headings":"","what":"Help","title":"Calculates Final Size for SIR Epidemic in Heterogenous Population","text":"report bug please open issue","code":""},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"contribute","dir":"","previous_headings":"","what":"Contribute","title":"Calculates Final Size for SIR Epidemic in Heterogenous Population","text":"Contributions finalsize welcomed. Please follow package contributing guide.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"code-of-conduct","dir":"","previous_headings":"","what":"Code of Conduct","title":"Calculates Final Size for SIR Epidemic in Heterogenous Population","text":"Please note finalsize project released Contributor Code Conduct. contributing project, agree abide terms.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Calculates Final Size for SIR Epidemic in Heterogenous Population","text":"Kucharski AJ, Kwok KO, Wei VW, Cowling BJ, Read JM, Lessler J, Cummings DA, Riley S. contribution social behaviour transmission influenza human population. PLOS Pathogens 2014;10(6):e1004206 PMID: 24968312","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_iterative.html","id":null,"dir":"Reference","previous_headings":"","what":"Iterative solver for final size. — .solve_iterative","title":"Iterative solver for final size. — .solve_iterative","text":"Iterative solver final size.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_iterative.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Iterative solver for final size. — .solve_iterative","text":"","code":".solve_iterative(   contact_matrix,   demography_vector,   susceptibility,   iterations = 10000L,   tolerance = 1e-06,   step_rate = 1.9,   adapt_step = TRUE )"},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_iterative.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Iterative solver for final size. — .solve_iterative","text":"contact_matrix Social contact matrix. Entry \\(mm_{ij}\\) gives average number contacts group \\(\\) reported participants group \\(j\\). demography_vector Demography vector. Entry \\(pp_{}\\) gives proportion total population group \\(\\) (model normalise needed). susceptibility matrix giving susceptibility individuals demographic group \\(\\) risk group \\(j\\). iterations Number solver iterations. Defaults 10,000. tolerance Solver error tolerance. Solving final size ends error drops tolerance. Defaults set 1e-6. Larger tolerance values likely lead inaccurate final size estimates. step_rate solver step rate. Defaults 1.9 value found work well. adapt_step Boolean, whether solver step rate changed based solver error. Defaults TRUE.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_iterative.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Iterative solver for final size. — .solve_iterative","text":"vector final sizes, size (N demography groups * N risk groups).","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_newton.html","id":null,"dir":"Reference","previous_headings":"","what":"Newton solver for final size. — .solve_newton","title":"Newton solver for final size. — .solve_newton","text":"Newton solver final size.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_newton.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Newton solver for final size. — .solve_newton","text":"","code":".solve_newton(   contact_matrix,   demography_vector,   susceptibility,   iterations = 10000L,   tolerance = 1e-06 )"},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_newton.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Newton solver for final size. — .solve_newton","text":"contact_matrix Social contact matrix. Entry \\(mm_{ij}\\) gives average number contacts group \\(\\) reported participants group \\(j\\). demography_vector Demography vector. Entry \\(pp_{}\\) gives proportion total population group \\(\\) (model normalise needed). susceptibility matrix giving susceptibility individuals demographic group \\(\\) risk group \\(j\\). iterations Number solver iterations. Defaults 10,000. tolerance Solver error tolerance. Solving final size ends error drops tolerance. Defaults set 1e-6. Larger tolerance values likely lead inaccurate final size estimates.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/dot-solve_newton.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Newton solver for final size. — .solve_newton","text":"two dimensional array final sizes per age-risk group.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":null,"dir":"Reference","previous_headings":"","what":"Final size of an epidemic — final_size","title":"Final size of an epidemic — final_size","text":"final_size calculates final size epidemic outbreak population heterogeneous mixing, heterogeneous susceptibility infection conferred immunisation programme.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Final size of an epidemic — final_size","text":"","code":"final_size(   r0,   contact_matrix,   demography_vector,   p_susceptibility,   susceptibility,   solver = c(\"iterative\", \"newton\"),   control = list() )"},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Final size of an epidemic — final_size","text":"r0 basic reproductive number \\(R_0\\) disease. contact_matrix Social contact matrix. Entry \\(m_{ij}\\) gives average number contacts group \\(\\) reported participants group \\(j\\) demography_vector Demography vector. Entry \\(v_{}\\) gives proportion total population group \\(\\) (model normalise needed). p_susceptibility matrix giving probability individual demography group \\(\\) risk (susceptibility) group \\(j\\). row represents overall distribution individuals demographic group \\(\\) across risk groups, row must sum 1.0. susceptibility matrix giving susceptibility individuals demographic group \\(\\) risk group \\(j\\). solver solver use. Options \"iterative\" (default) \"newton\", iterative solver, Newton solver, respectively. Special conditions apply using Newton solver, see control argument. control list named solver options, see Solver options.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Final size of an epidemic — final_size","text":"data.frame proportion infected individuals, within demography group susceptibility group combination. demography groups susceptibility groups named, names added relevant columns. groups named, synthetic names added (e.g. demo_grp_1, susc_grp_1).","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"solver-options","dir":"Reference","previous_headings":"","what":"Solver options","title":"Final size of an epidemic — final_size","text":"control argument accepts list solver options, iterative solver taking two extra arguments Newton solver. optional argument, default options used within solver functions argument missing. Arguments provided override solver defaults.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"common-options","dir":"Reference","previous_headings":"","what":"Common options","title":"Final size of an epidemic — final_size","text":"iterations: number iterations solve final size, unless error solver tolerance. Default = 10000. tolerance: solver tolerance; solving final size ends error drops tolerance. Defaults set 1e-6. Larger tolerance values likely lead inaccurate final size estimates.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"iterative-solver-options","dir":"Reference","previous_headings":"","what":"Iterative solver options","title":"Final size of an epidemic — final_size","text":"step_rate: solver step rate. Defaults 1.9 value found work well. adapt_step: Boolean, whether solver step rate changed based solver error. Defaults TRUE.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/reference/final_size.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Final size of an epidemic — final_size","text":"","code":"library(socialmixr) #>  #> Attaching package: ‘socialmixr’ #> The following object is masked from ‘package:utils’: #>  #>     cite data(polymod) r0 <- 2.0 contact_data <- contact_matrix(   polymod,   countries = \"United Kingdom\",   age.limits = c(0, 20, 40),   symmetric = TRUE ) #> Using POLYMOD social contact data. To cite this in a publication, use the 'cite' function #> Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option contact_matrix <- contact_data$matrix demography_vector <- contact_data$demography$population  # scale by maximum real eigenvalue and divide by demography contact_matrix <- contact_matrix / max(eigen(contact_matrix)$values) contact_matrix <- contact_matrix / demography_vector  n_demo_grps <- length(demography_vector) n_risk_grps <- 3  # prepare p_susceptibility and susceptibility psusc <- matrix(   data = 1, nrow = n_demo_grps, ncol = n_risk_grps ) psusc <- psusc / rowSums(psusc) # In this example, all risk groups from all age groups are completely # susceptible susc <- matrix(   data = 1, nrow = n_demo_grps, ncol = n_risk_grps )  # using default settings - this selects the iterative solver final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   p_susceptibility = psusc,   susceptibility = susc ) #>     demo_grp   susc_grp susceptibility p_infected #> 1 demo_grp_1 susc_grp_1              1  0.8947582 #> 2 demo_grp_2 susc_grp_1              1  0.8384984 #> 3 demo_grp_3 susc_grp_1              1  0.5516973 #> 4 demo_grp_1 susc_grp_2              1  0.8947582 #> 5 demo_grp_2 susc_grp_2              1  0.8384984 #> 6 demo_grp_3 susc_grp_2              1  0.5516973 #> 7 demo_grp_1 susc_grp_3              1  0.8947582 #> 8 demo_grp_2 susc_grp_3              1  0.8384984 #> 9 demo_grp_3 susc_grp_3              1  0.5516973  # using manually specified solver settings control <- list(   iterations = 1000,   tolerance = 1e-6,   step_rate = 1.9,   adapt_step = TRUE )  final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   p_susceptibility = psusc,   susceptibility = susc,   solver = \"iterative\",   control = control ) #>     demo_grp   susc_grp susceptibility p_infected #> 1 demo_grp_1 susc_grp_1              1  0.8947582 #> 2 demo_grp_2 susc_grp_1              1  0.8384984 #> 3 demo_grp_3 susc_grp_1              1  0.5516973 #> 4 demo_grp_1 susc_grp_2              1  0.8947582 #> 5 demo_grp_2 susc_grp_2              1  0.8384984 #> 6 demo_grp_3 susc_grp_2              1  0.5516973 #> 7 demo_grp_1 susc_grp_3              1  0.8947582 #> 8 demo_grp_2 susc_grp_3              1  0.8384984 #> 9 demo_grp_3 susc_grp_3              1  0.5516973  # manual settings for the newton solver control <- list(   iterations = 50000,   tolerance = 1e-12 )  final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   p_susceptibility = psusc,   susceptibility = susc,   solver = \"newton\",   control = control ) #>     demo_grp   susc_grp susceptibility p_infected #> 1 demo_grp_1 susc_grp_1              1  0.8947582 #> 2 demo_grp_2 susc_grp_1              1  0.8384984 #> 3 demo_grp_3 susc_grp_1              1  0.5516973 #> 4 demo_grp_1 susc_grp_2              1  0.8947582 #> 5 demo_grp_2 susc_grp_2              1  0.8384984 #> 6 demo_grp_3 susc_grp_2              1  0.5516973 #> 7 demo_grp_1 susc_grp_3              1  0.8947582 #> 8 demo_grp_2 susc_grp_3              1  0.8384984 #> 9 demo_grp_3 susc_grp_3              1  0.5516973"}]
