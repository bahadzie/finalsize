<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="finalsize">
<title>Modelling heterogeneous susceptibility • finalsize</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Modelling heterogeneous susceptibility">
<meta property="og:description" content="finalsize">
<meta property="og:image" content="https://epiverse-trace.github.io/finalsize/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">finalsize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/finalsize.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Package vignettes</h6>
    <a class="dropdown-item" href="../articles/varying_susceptibility.html">Modelling heterogeneous susceptibility</a>
    <a class="dropdown-item" href="../articles/uncertainty_params.html">Modelling uncertainty in R₀</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epiverse-trace/finalsize/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Modelling heterogeneous susceptibility</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/finalsize/blob/HEAD/vignettes/varying_susceptibility.Rmd" class="external-link"><code>vignettes/varying_susceptibility.Rmd</code></a></small>
      <div class="d-none name"><code>varying_susceptibility.Rmd</code></div>
    </div>

    
    
<p>Populations are often heterogeneous in their susceptibility to infection following exposure, independent of the exposure risk that comes from different social contact patterns. Such heterogeneity may be age-dependent and vary between age groups. It may also vary within age groups due to prior infection resulting in immunity or due to immunisation. Combinations of within- and between-group variation in susceptibility may also occur, and can be incorporated into final size calculations <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3506030/" class="external-link"><span class="citation">(<a href="#ref-miller2012" role="doc-biblioref">Miller 2012</a>)</span></a>.</p>
<div class="alert alert-warning">
<p><strong>New to <em>finalsize</em>?</strong> It may help to read the <a href="finalsize.html">“Basic usage”</a> vignette first!</p>
</div>
<div class="section level2 unnumbered alert alert-primary">
<h2 id="use-case">Use case<a class="anchor" aria-label="anchor" href="#use-case"></a>
</h2>
<p>There is substantial <strong>heterogeneity in susceptibility to infection</strong> in a population. We want to know how this heterogeneity could affect the final size of the epidemic.</p>
</div>
<div class="alert alert-secondary">
<div class="section level3 unnumbered">
<h3 id="what-we-have">What we have<a class="anchor" aria-label="anchor" href="#what-we-have"></a>
</h3>
<ol style="list-style-type: decimal">
<li>In addition to the infection <span class="math inline">\(R_0\)</span>, demography data, and social contact data;</li>
<li>Data on within- and between-group variation in susceptibility to the infection; and</li>
<li>Data on the proportion (or probability) of individuals in any demographic group in a specific susceptibility (or risk) group.</li>
</ol>
</div>
<div class="section level3 unnumbered">
<h3 id="what-we-assume">What we assume<a class="anchor" aria-label="anchor" href="#what-we-assume"></a>
</h3>
<ol style="list-style-type: decimal">
<li>In addition to an SIR epidemic;</li>
<li>The partitioning of individuals into demographic and risk groups is complete, i.e., no individuals remain unaccounted for.</li>
</ol>
</div>
</div>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://epiverse-trace.github.io/finalsize/">finalsize</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load necessary packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://colorspace.R-Forge.R-project.org/" class="external-link">colorspace</a></span><span class="op">)</span></span></code></pre></div>
</details><div class="section level2">
<h2 id="getting-r_0-and-contact-and-demography-data">Getting <span class="math inline">\(R_0\)</span> and contact and demography data<a class="anchor" aria-label="anchor" href="#getting-r_0-and-contact-and-demography-data"></a>
</h2>
<p>This example uses social contact data from the <a href="https://cordis.europa.eu/project/id/502084" class="external-link">POLYMOD</a> project to estimate the final size of an epidemic in the U.K. These data are provided with the <code>socialmixr</code> package.</p>
<p>These data are handled just as in the <a href="finalsize.html">“Basic usage”</a> vignette, and the code is not displayed here. This example also considers a disease with an <span class="math inline">\(R_0\)</span> of 2.0.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get UK polymod data</span></span>
<span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="va"><a href="https://epiforecasts.io/socialmixr/reference/polymod.html" class="external-link">polymod</a></span></span>
<span><span class="va">contact_data</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu"><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">contact_matrix</a></span><span class="op">(</span></span>
<span>  <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">18</span>, <span class="fl">40</span>, <span class="fl">65</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get the contact matrix and demography data</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span><span class="va">demography_vector</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span></span>
<span><span class="co"># scale the contact matrix so the largest eigenvalue is 1.0</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="va">contact_matrix</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># divide each row of the contact matrix by the corresponding demography</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="va">contact_matrix</span> <span class="op">/</span> <span class="va">demography_vector</span></span>
<span></span>
<span><span class="va">n_demo_grps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span></span></code></pre></div>
</details><details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r0</span> <span class="op">&lt;-</span> <span class="fl">2.0</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="susceptibility-variation-between-age-groups">Susceptibility variation between age groups<a class="anchor" aria-label="anchor" href="#susceptibility-variation-between-age-groups"></a>
</h2>
<p>This example considers a scenario in which susceptibility to infection varies between age groups, but not within groups.
In this example, susceptibility to infection increases with age.</p>
<p>This can be modelled as a susceptibility matrix with higher values for the 40 – 60 and 65+ age groups, and relatively lower values for other groups.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># susceptibility is higher for the old</span></span>
<span><span class="va">susc_variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">n_susc_groups</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span></code></pre></div>
</details><div class="alert alert-warning">
<p><strong>Note</strong> that the susceptibility matrix (<code>susc_variable</code>) still has only one column. The next example will show why this is modelled as a matrix.</p>
</div>
<p>The corresponding demography-susceptibility group distribution matrix is a one-column matrix of 1.0s: there is no variation in susceptibility within groups.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_susc_uniform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">n_demo_grps</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">n_susc_groups</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>We can compare the final size in a population with heterogeneous susceptibility against that of a population with a uniform, high susceptibility.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run final_size with default solvers and control options</span></span>
<span><span class="co"># final size with heterogeneous susceptibility</span></span>
<span><span class="va">final_size_heterog</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/final_size.html">final_size</a></span><span class="op">(</span></span>
<span>  r0 <span class="op">=</span> <span class="va">r0</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  susceptibility <span class="op">=</span> <span class="va">susc_variable</span>,</span>
<span>  p_susceptibility <span class="op">=</span> <span class="va">p_susc_uniform</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare uniform susceptibility matrix</span></span>
<span><span class="va">susc_uniform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1.0</span>, nrow <span class="op">=</span> <span class="va">n_demo_grps</span>, ncol <span class="op">=</span> <span class="va">n_susc_groups</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run final size with uniform susceptibility</span></span>
<span><span class="va">final_size_uniform</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/final_size.html">final_size</a></span><span class="op">(</span></span>
<span>  r0 <span class="op">=</span> <span class="va">r0</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  susceptibility <span class="op">=</span> <span class="va">susc_uniform</span>,</span>
<span>  p_susceptibility <span class="op">=</span> <span class="va">p_susc_uniform</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># assign scenario name and join data</span></span>
<span><span class="va">final_size_heterog</span><span class="op">$</span><span class="va">scenario</span> <span class="op">&lt;-</span> <span class="st">"heterogeneous"</span></span>
<span><span class="va">final_size_uniform</span><span class="op">$</span><span class="va">scenario</span> <span class="op">&lt;-</span> <span class="st">"uniform"</span></span>
<span></span>
<span><span class="co"># join dataframes</span></span>
<span><span class="va">final_size_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">final_size_heterog</span>,</span>
<span>  <span class="va">final_size_uniform</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare age group order</span></span>
<span><span class="va">final_size_data</span><span class="op">$</span><span class="va">demo_grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="va">final_size_data</span><span class="op">$</span><span class="va">demo_grp</span>,</span>
<span>  levels <span class="op">=</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">age.group</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>Visualise the effect of modelling age-dependent susceptibility against uniform susceptibility for all age groups.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">final_size_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">demo_grp</span>, y <span class="op">=</span> <span class="va">p_infected</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">scenario</span></span>
<span>    <span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span></span>
<span>      width <span class="op">=</span> <span class="fl">0.75</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://colorspace.R-Forge.R-project.org/reference/scale_colour_discrete_qualitative.html" class="external-link">scale_fill_discrete_qualitative</a></span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"Cold"</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Population susceptibility"</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Heterogeneous"</span>, <span class="st">"Uniform"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">ggtext</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/ggtext/reference/element_markdown.html" class="external-link">element_markdown</a></span><span class="op">(</span></span>
<span>      vjust <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Age group"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"% Infected"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-9"></span>
<img src="varying_susceptibility_files/figure-html/unnamed-chunk-9-1.png" alt="Final sizes of epidemics in populations wherein susceptibility to the infection is either uniform (green), or heterogeneous (purple), with older individuals more susceptible to the infection."><p class="caption">
Figure 1: Final sizes of epidemics in populations wherein susceptibility to the infection is either uniform (green), or heterogeneous (purple), with older individuals more susceptible to the infection.
</p>
</div>
<div class="alert alert-warning">
<p><strong>Note</strong> that, as shown in this example, a population with heterogeneous susceptibility is <em>always</em> expected to have a lower final epidemic size overall than an otherwise identical population that is fully susceptible.</p>
<p>This illustrates the broader point that infections in any one age group are <em>not independent</em> of the infections in other age groups. This is due to direct or indirect social contacts between age groups.</p>
<p>Reducing the susceptibility (and thus infections) of one age group can indirectly help to reduce infections in other age groups as well, because the overall level of epidemic transmission will be reduced.</p>
</div>
</div>
<div class="section level2">
<h2 id="susceptibility-variation-within-and-between-age-groups">Susceptibility variation within and between age groups<a class="anchor" aria-label="anchor" href="#susceptibility-variation-within-and-between-age-groups"></a>
</h2>
<p>This example considers a scenario in which susceptibility to infection varies within and between age groups.
Immunisation against infection through an intervention campaign is a common cause of within-age group variation in susceptibility, and this example can be thought of as examining the effect of vaccination.</p>
<p>The effect of immunisation on susceptibility can be modelled as a reduction of the initial susceptibility of each age group. This is done by adding a column to the susceptibility matrix, with lower values than the first column.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># immunisation effect</span></span>
<span><span class="va">immunisation_effect</span> <span class="op">&lt;-</span> <span class="fl">0.25</span></span></code></pre></div>
</details><p>This example considers a modest 25% reduction in susceptibility due to vaccination.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># model an immunised group with a 25% lower susceptibility</span></span>
<span><span class="va">susc_immunised</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">susc_variable</span>,</span>
<span>  <span class="va">susc_variable</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">immunisation_effect</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assign names to groups</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">susc_immunised</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Un-immunised"</span>, <span class="st">"Immunised"</span><span class="op">)</span></span>
<span><span class="va">n_risk_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">susc_immunised</span><span class="op">)</span></span></code></pre></div>
</details><div class="alert alert-warning">
<p><strong>Note</strong> that because there are two susceptibility groups, the susceptibility matrix has two columns. The corresponding <strong>demography-susceptibility distribution matrix</strong> must also have two columns!</p>
</div>
<p>We also need to model the proportion of each age group that has been immunised, and which therefore has lower susceptibility to the infection. To do this, we can modify the demography-susceptibility distribution matrix.</p>
<p>This example model considers half of each age group to be in the immunised and non-immunised groups.</p>
<p>In general terms, this could be interpreted as the rate of vaccine uptake, or as the effect of existing immunity from previous infection by a similar pathogen.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># immunisation increases with age between 20% (infants) and 90% (65+)</span></span>
<span><span class="va">immunisation_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">n_demo_grps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add a second column to p_susceptibility</span></span>
<span><span class="va">p_susc_immunised</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  susceptible <span class="op">=</span> <span class="va">p_susc_uniform</span> <span class="op">-</span> <span class="va">immunisation_rate</span>,</span>
<span>  immunised <span class="op">=</span> <span class="va">immunisation_rate</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="alert alert-warning">
<p><strong>Recall</strong> that each row of the demography-susceptibility distribution matrix must always sum to 1.0!</p>
</div>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we run final size over all r0 values</span></span>
<span><span class="va">final_size_immunised</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/final_size.html">final_size</a></span><span class="op">(</span></span>
<span>  r0 <span class="op">=</span> <span class="va">r0</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  susceptibility <span class="op">=</span> <span class="va">susc_immunised</span>,</span>
<span>  p_susceptibility <span class="op">=</span> <span class="va">p_susc_immunised</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add scenario identifier</span></span>
<span><span class="va">final_size_immunised</span><span class="op">$</span><span class="va">scenario</span> <span class="op">&lt;-</span> <span class="st">"immunisation"</span></span>
<span></span>
<span><span class="co"># prepare age group order</span></span>
<span><span class="va">final_size_heterog</span><span class="op">$</span><span class="va">demo_grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="va">final_size_heterog</span><span class="op">$</span><span class="va">demo_grp</span>,</span>
<span>  levels <span class="op">=</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">age.group</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">final_size_immunised</span><span class="op">$</span><span class="va">demo_grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="va">final_size_immunised</span><span class="op">$</span><span class="va">demo_grp</span>,</span>
<span>  levels <span class="op">=</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">age.group</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>The effect of immunisation (or some other reduction in susceptibility) can be visualised by comparing the proportion of the immunised and un-immunised groups that are infected.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">final_size_immunised</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">final_size_heterog</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">demo_grp</span>, y <span class="op">=</span> <span class="va">p_infected</span>,</span>
<span>      fill <span class="op">=</span> <span class="st">"baseline"</span>,</span>
<span>      colour <span class="op">=</span> <span class="st">"baseline"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">demo_grp</span>, y <span class="op">=</span> <span class="va">p_infected</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">susc_grp</span></span>
<span>    <span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://colorspace.R-Forge.R-project.org/reference/scale_colour_discrete_qualitative.html" class="external-link">scale_fill_discrete_qualitative</a></span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"Dynamic"</span>,</span>
<span>    rev <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Immunised"</span>, <span class="st">"Un-immunised"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Immunisation scenario"</span>,</span>
<span>    na.value <span class="op">=</span> <span class="st">"lightgrey"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    labels <span class="op">=</span> <span class="st">"Susceptibility heterogeneous\nbetween groups,\nno immunisation"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">ggtext</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/ggtext/reference/element_markdown.html" class="external-link">element_markdown</a></span><span class="op">(</span></span>
<span>      vjust <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span></span>
<span>      override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span></span>
<span>      nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      title.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Age group"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"% Infected"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Immunisation\nscenario"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-14"></span>
<img src="varying_susceptibility_files/figure-html/unnamed-chunk-14-1.png" alt="Final size of an SIR epidemic with $R_0$ = 2.0, in a population wherein 50% of each age group is immunised against the infection. The immunisation is assumed to reduce the initial susceptibility of each age group by 25%. This leads to both within- and between-group heterogeneity in susceptibility. Vaccinating even 50% of each age group can substantially reduce the epidemic final size in comparison with a scenario in which there is no immunisation (grey). Note that the final sizes in this figure are all below 50%."><p class="caption">
Figure 2: Final size of an SIR epidemic with <span class="math inline">\(R_0\)</span> = 2.0, in a population wherein 50% of each age group is immunised against the infection. The immunisation is assumed to reduce the initial susceptibility of each age group by 25%. This leads to both within- and between-group heterogeneity in susceptibility. Vaccinating even 50% of each age group can substantially reduce the epidemic final size in comparison with a scenario in which there is no immunisation (grey). Note that the final sizes in this figure are all below 50%.
</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-miller2012" class="csl-entry">
Miller, Joel C. 2012. <span>“A Note on the Derivation of Epidemic Final Sizes.”</span> <em>Bulletin of Mathematical Biology</em> 74 (9): 2125–41. <a href="https://doi.org/10.1007/s11538-012-9749-6" class="external-link">https://doi.org/10.1007/s11538-012-9749-6</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Pratik Gupte, Edwin Van Leeuwen, Adam Kucharski.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
