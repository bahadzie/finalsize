<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="finalsize">
<title>Calculating the final size of an epidemic • finalsize</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating the final size of an epidemic">
<meta property="og:description" content="finalsize">
<meta property="og:image" content="https://epiverse-trace.github.io/finalsize/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">finalsize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/finalsize.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Package vignettes</h6>
    <a class="dropdown-item" href="../articles/varying_susceptibility.html">Modelling heterogeneous susceptibility</a>
    <a class="dropdown-item" href="../articles/uncertainty_params.html">Modelling uncertainty in R₀</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epiverse-trace/finalsize/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculating the final size of an epidemic</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/finalsize/blob/HEAD/vignettes/finalsize.Rmd" class="external-link"><code>vignettes/finalsize.Rmd</code></a></small>
      <div class="d-none name"><code>finalsize.Rmd</code></div>
    </div>

    
    
<p>When analysing an epidemic-prone infection, such as pandemic influenza, it is important to understand how many infections there could be in total. The overall number of infections that occur during such an epidemic, is called the ‘final epidemic size’.
The expected final size of an epidemic can be calculated using methods detailed in <span class="citation">Andreasen (<a href="#ref-andreasen2011" role="doc-biblioref">2011</a>)</span>, <span class="citation">Miller (<a href="#ref-miller2012" role="doc-biblioref">2012</a>)</span>, <span class="citation">Kucharski et al. (<a href="#ref-kucharski2014" role="doc-biblioref">2014</a>)</span>, and <span class="citation">Bidari et al. (<a href="#ref-bidari2016" role="doc-biblioref">2016</a>)</span>, and which are implemented in the <em>finalsize</em> package.</p>
<div class="section level2 unnumbered alert alert-primary">
<h2 id="use-case">Use case<a class="anchor" aria-label="anchor" href="#use-case"></a>
</h2>
<p>An epidemic is underway. We want to know <strong>how many individuals we would expect to be infected in total</strong> for a given level of transmission and population susceptibility: this is the cumulative sum of all infections, or the <em>final size</em> of the epidemic.</p>
</div>
<div class="alert alert-secondary">
<div class="section level3 unnumbered">
<h3 id="what-we-have">What we have<a class="anchor" aria-label="anchor" href="#what-we-have"></a>
</h3>
<ol style="list-style-type: decimal">
<li>An estimate of the infection’s basic reproduction number <span class="math inline">\(R_0\)</span>;</li>
<li>An estimate of the distribution of the population in different demographic groups (typically age groups);</li>
<li>An estimate of the contacts between individuals of different demographic groups; and</li>
<li>An estimate of the susceptibility of each demographic group to the infection.</li>
</ol>
</div>
<div class="section level3 unnumbered">
<h3 id="what-we-assume">What we assume<a class="anchor" aria-label="anchor" href="#what-we-assume"></a>
</h3>
<ol style="list-style-type: decimal">
<li>That the infection dynamics can be captured using a Susceptible-Infectious-Recovered (SIR) or Susceptible-Exposed-Infectious-Recovered (SEIR) model, where individuals who have been infected acquire immunity against subsequent infection, at least for the remaining duration of the epidemic.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="getting-finalsize">Getting <em>finalsize</em><a class="anchor" aria-label="anchor" href="#getting-finalsize"></a>
</h2>
<p>The <em>finalsize</em> package is currently available on <a href="https://github.com/epiverse-trace/finalsize" class="external-link">Github</a>, and can be installed using the <code>remotes</code> or <code>devtools</code> packages.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first install the remotes packages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># install finalsize using remotes</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"epiverse-trace/finalsize"</span><span class="op">)</span></span></code></pre></div>
</details><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiverse-trace/finalsize" class="external-link">finalsize</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load necessary packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="defining-a-value-for-r_0">Defining a value for <span class="math inline">\(R_0\)</span><a class="anchor" aria-label="anchor" href="#defining-a-value-for-r_0"></a>
</h2>
<p>A number of statistical methods can be used to estimate the <span class="math inline">\(R_0\)</span> of an epidemic in its early stages from available data. These are not discussed here, but some examples are given in the <a href="https://epiverse-trace.github.io/episoap/articles/episoap.html" class="external-link"><em>episoap</em> package</a>.</p>
<p>Instead, this example considers a infection with an <span class="math inline">\(R_0\)</span> of 2.0, similar to that which could potentially be observed for pandemic influenza.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define r0 as 2.0</span></span>
<span><span class="va">r0</span> <span class="op">&lt;-</span> <span class="fl">2.0</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="getting-and-preparing-contact-and-demography-data">Getting and preparing contact and demography data<a class="anchor" aria-label="anchor" href="#getting-and-preparing-contact-and-demography-data"></a>
</h2>
<p>This example uses social contact data from the <a href="https://cordis.europa.eu/project/id/502084" class="external-link">POLYMOD</a> project to estimate the final size of an epidemic in the U.K. These data are provided with the <code>socialmixr</code> package.</p>
<p>The contact data are divided into five age groups: 0 – 5, 5 – 18, 18 – 40, 40 – 65, and 65 and over, specified using the <code>age.limits</code> argument in <code><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">socialmixr::contact_matrix()</a></code>.
The <code>symmetric = TRUE</code> argument to <code><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">socialmixr::contact_matrix()</a></code> returns a symmetric contact matrix, so that the contacts reported by group <span class="math inline">\(\{i\}\)</span> of individuals from group <span class="math inline">\(\{j\}\)</span> are the same as those reported by group <span class="math inline">\(\{j\}\)</span> of group <span class="math inline">\(\{i\}\)</span>.</p>
<p>The demographic data — the number of individuals in each age group — is also available through <code><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">socialmixr::contact_matrix()</a></code>.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get UK polymod data</span></span>
<span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="va"><a href="https://epiforecasts.io/socialmixr/reference/polymod.html" class="external-link">polymod</a></span></span>
<span><span class="va">contact_data</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu"><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">contact_matrix</a></span><span class="op">(</span></span>
<span>  <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">18</span>, <span class="fl">40</span>, <span class="fl">65</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get the contact matrix and demography data</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span><span class="va">demography_vector</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="va">demography_data</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span></span>
<span></span>
<span><span class="co"># scale the contact matrix so the largest eigenvalue is 1.0</span></span>
<span><span class="co"># this is to ensure that the overall epidemic dynamics correctly reflect</span></span>
<span><span class="co"># the assumed value of R0</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="va">contact_matrix</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># divide each row of the contact matrix by the corresponding demography</span></span>
<span><span class="co"># this reflects the assumption that each individual in group {j} make contacts</span></span>
<span><span class="co"># at random with individuals in group {i}</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="va">contact_matrix</span> <span class="op">/</span> <span class="va">demography_vector</span></span>
<span></span>
<span><span class="va">n_demo_grps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span></span></code></pre></div>
</details><div class="section level3 unnumbered alert alert-secondary">
<h3 id="heterogeneous-social-mixing">Heterogeneous social mixing<a class="anchor" aria-label="anchor" href="#heterogeneous-social-mixing"></a>
</h3>
<p>The social contact data used in this example illustrate an important way in which populations may be heterogeneous: the various age groups can have substantially different patterns of social contacts, and hence different probabilities of acquiring and transmitting infection during an epidemic.</p>
<p>The method implemented in <em>finalsize</em> accounts for this heterogeneity. Other forms of population heterogeneity are covered in the <a href="varying_susceptibility.html">“Heterogeneous susceptibility”</a> vignette.</p>
</div>
</div>
<div class="section level2">
<h2 id="population-susceptibility">Population susceptibility<a class="anchor" aria-label="anchor" href="#population-susceptibility"></a>
</h2>
<p>As a starting scenario, consider a novel pathogen where all age groups have a similar, high susceptibility to infection. This means it is assumed that all individuals fall into a single category: fully susceptible.</p>
<p>Full uniform susceptibility can be modelled as a matrix with values of 1.0, with as many rows as there are demographic groups. The matrix has a single column, representing the single susceptibility group to which all individuals belong.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># all individuals are equally and highly susceptible</span></span>
<span><span class="va">n_susc_groups</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span>
<span><span class="va">susc_guess</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span></code></pre></div>
</details><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">susc_uniform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">susc_guess</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">n_demo_grps</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">n_susc_groups</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>Final size calculations also need to know the proportion of each demographic group <span class="math inline">\(\{i\}\)</span> that falls into the susceptibility group <span class="math inline">\(\{j\}\)</span>. This distribution of age groups into susceptibility groups can be represented by the demography-susceptibility distribution matrix.</p>
<p>Since all individuals in each age group have the same susceptibility, there is no variation within age groups. Consequently, all individuals in each age group are assumed to be fully susceptible. This can be represented as a single-column matrix, with as many rows as age groups, and as many columns as susceptibility groups.</p>
<p>In this example, the matrix <code>p_susc_uniform</code> has 5 rows, one for each age group, and only one column, for the single high susceptibility group that holds all individuals.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_susc_uniform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">n_demo_grps</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">n_susc_groups</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="section level4 unnumbered alert alert-secondary">
<h4 id="why-susceptibility-and-p_susceptibility-are-matrices">Why susceptibility and p_susceptibility are matrices<a class="anchor" aria-label="anchor" href="#why-susceptibility-and-p_susceptibility-are-matrices"></a>
</h4>
<p>This example models susceptibility (<code>susc_uniform</code>) and the demography-in-susceptibility (<code>p_susc_uniform</code>) as matrices rather than vectors. This is because a single susceptibility group is a special case of the general final size equation.</p>
<p><em>finalsize</em> supports multiple susceptibility groups (this will be covered later), and these are more easily represented as a matrix, the <em>susceptibility matrix</em>.</p>
<p>Each element <span class="math inline">\(\{i, j\}\)</span> in this matrix represents the susceptibility of individuals in demographic group <span class="math inline">\(\{i\}\)</span>, and susceptibility group <span class="math inline">\(\{j\}\)</span>.</p>
<p>In this example, all individuals are equally susceptible to infection, and thus the susceptibility matrix (<code>susc_uniform</code>) has only a single column with identical values.</p>
<p>Consequently, the demography-susceptibility distribution matrix (<code>p_susc_uniform</code>) has the same dimensions, and all of its values are 1.0.</p>
<p>See the <a href="varying_susceptibility.html">“Heterogeneous susceptibility”</a> example for more on cases where susceptibility varies within age groups.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-final_size">Running <code>final_size</code><a class="anchor" aria-label="anchor" href="#running-final_size"></a>
</h2>
<p>The final size of the epidemic in the population can then be calculated using the only function in the package, <code><a href="../reference/final_size.html">final_size()</a></code>. This example allows the function to fall back on the default options for the arguments <code>solver</code> (<code>"iterative"</code>) and <code>control</code> (an empty list).</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate final size</span></span>
<span><span class="va">final_size_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/final_size.html">final_size</a></span><span class="op">(</span></span>
<span>  r0 <span class="op">=</span> <span class="va">r0</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  susceptibility <span class="op">=</span> <span class="va">susc_uniform</span>,</span>
<span>  p_susceptibility <span class="op">=</span> <span class="va">p_susc_uniform</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># order demographic groups</span></span>
<span><span class="va">final_size_data</span><span class="op">$</span><span class="va">demo_grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="va">final_size_data</span><span class="op">$</span><span class="va">demo_grp</span>,</span>
<span>  levels <span class="op">=</span> <span class="va">demography_data</span><span class="op">$</span><span class="va">age.group</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="section level3">
<h3 id="visualise-final-sizes">Visualise final sizes<a class="anchor" aria-label="anchor" href="#visualise-final-sizes"></a>
</h3>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">final_size_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      <span class="va">demo_grp</span>, <span class="va">p_infected</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"lightgrey"</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Age group"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"% Infected"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-9"></span>
<img src="finalsize_files/figure-html/unnamed-chunk-9-1.png" alt="Final size of an SIR epidemic in each age group. The final size is the cumulative number of infections in each age group over the course of the epidemic, expressed as a proportion of the respective age group."><p class="caption">
Figure 1: Final size of an SIR epidemic in each age group. The final size is the cumulative number of infections in each age group over the course of the epidemic, expressed as a proportion of the respective age group.
</p>
</div>
</div>
<div class="section level3">
<h3 id="final-size-proportions-to-counts">Final size proportions to counts<a class="anchor" aria-label="anchor" href="#final-size-proportions-to-counts"></a>
</h3>
<p><code>finalsize</code> returns the <em>proportion</em> of each age (and susceptibility) group infected in an epidemic outbreak. The final <em>counts</em> of individuals infected can be visualised as well, by multiplying the final proportion of each age group infected with the total number of individuals in that group.</p>
<p>The example below show how this can be done.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare demography data</span></span>
<span><span class="va">demography_data</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span></span>
<span></span>
<span><span class="co"># merge final size counts with demography vector</span></span>
<span><span class="va">final_size_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge.data.table</a></span><span class="op">(</span></span>
<span>  <span class="va">final_size_data</span>,</span>
<span>  <span class="va">demography_data</span>,</span>
<span>  by.x <span class="op">=</span> <span class="st">"demo_grp"</span>,</span>
<span>  by.y <span class="op">=</span> <span class="st">"age.group"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reset age group order</span></span>
<span><span class="va">final_size_data</span><span class="op">$</span><span class="va">demo_grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="va">final_size_data</span><span class="op">$</span><span class="va">demo_grp</span>,</span>
<span>  levels <span class="op">=</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">age.group</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># multiply counts with proportion infected</span></span>
<span><span class="va">final_size_data</span><span class="op">$</span><span class="va">n_infected</span> <span class="op">&lt;-</span> <span class="va">final_size_data</span><span class="op">$</span><span class="va">p_infected</span> <span class="op">*</span></span>
<span>  <span class="va">final_size_data</span><span class="op">$</span><span class="va">population</span></span></code></pre></div>
</details><details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">final_size_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">demo_grp</span>, y <span class="op">=</span> <span class="va">n_infected</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"lightgrey"</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma_format</a></span><span class="op">(</span></span>
<span>      scale <span class="op">=</span> <span class="fl">1e-6</span>, suffix <span class="op">=</span> <span class="st">"M"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15e6</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Age group"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number infected (millions)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-11"></span>
<img src="finalsize_files/figure-html/unnamed-chunk-11-1.png" alt="Final size of an epidemic outbreak in a population, for different values of infection $R_0$. Converting the final size proportions in each age group to counts shows that individuals aged 18 -- 65 make up the bulk of cases in this scenario. This may be attributed to this being both the largest age range in the analysis (more years in this range than any other), and because more people fall into this wide range than others. Contrast this figure with the one above, in which similar _proportions_ of each age group are infected."><p class="caption">
Figure 2: Final size of an epidemic outbreak in a population, for different values of infection <span class="math inline">\(R_0\)</span>. Converting the final size proportions in each age group to counts shows that individuals aged 18 – 65 make up the bulk of cases in this scenario. This may be attributed to this being both the largest age range in the analysis (more years in this range than any other), and because more people fall into this wide range than others. Contrast this figure with the one above, in which similar <em>proportions</em> of each age group are infected.
</p>
</div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-andreasen2011" class="csl-entry">
Andreasen, Viggo. 2011. <span>“The Final Size of an Epidemic and Its Relation to the Basic Reproduction Number.”</span> <em>Bulletin of Mathematical Biology</em> 73 (10): 2305–21. <a href="https://doi.org/10.1007/s11538-010-9623-3" class="external-link">https://doi.org/10.1007/s11538-010-9623-3</a>.
</div>
<div id="ref-bidari2016" class="csl-entry">
Bidari, Subekshya, Xinying Chen, Daniel Peters, Dylanger Pittman, and Péter L. Simon. 2016. <span>“Solvability of Implicit Final Size Equations for <span>SIR</span> Epidemic Models.”</span> <em>Mathematical Biosciences</em> 282 (December): 181–90. <a href="https://doi.org/10.1016/j.mbs.2016.10.012" class="external-link">https://doi.org/10.1016/j.mbs.2016.10.012</a>.
</div>
<div id="ref-kucharski2014" class="csl-entry">
Kucharski, Adam J., Kin O. Kwok, Vivian W. I. Wei, Benjamin J. Cowling, Jonathan M. Read, Justin Lessler, Derek A. Cummings, and Steven Riley. 2014. <span>“The Contribution of Social Behaviour to the Transmission of Influenza <span>A</span> in a Human Population.”</span> <em>PLoS Pathogens</em> 10 (6): e1004206. <a href="https://doi.org/10.1371/journal.ppat.1004206" class="external-link">https://doi.org/10.1371/journal.ppat.1004206</a>.
</div>
<div id="ref-miller2012" class="csl-entry">
Miller, Joel C. 2012. <span>“A Note on the Derivation of Epidemic Final Sizes.”</span> <em>Bulletin of Mathematical Biology</em> 74 (9): 2125–41. <a href="https://doi.org/10.1007/s11538-012-9749-6" class="external-link">https://doi.org/10.1007/s11538-012-9749-6</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Pratik Gupte, Edwin Van Leeuwen, Adam Kucharski.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
